# 保护模式

## 1 GDT

### 1.1 由来

​		我们知道，为了让程序在内存中能自由浮动而又不影响它的正常执行，处理器将内存划分成逻辑上的段，并在指令中使用段内偏移。在保护模式下，对内存的访问仍然使用段地址和偏移地址，但是，在每个段能够访问之前，必须先进行登记。**所以每个段都需要一个描述符，每个段描述符需要用8字节来描述**。为了存放这些描述符，需要在内存中开辟出一段空间。在这段空间里，所有的描述符都是挨在一起集中存放的，这就构成了一个描述符表，也就是全局描述符表（GDT）。

​		**在进入保护模式前，必须要定义全局描述符表**：

理论上，全局描述符表可以位于内存中的任何地方。但是，由于在进入保护模式之后，处理器要立即按新的内存访问模式工作，所以，必须在进入保护模式之前定义GDT。但是，**由于在实模式下只能访问1MB的内存**，故GDT通常都定义在1MB以下的内存范围中。**当然，允许在进入保护模式之后换个位置重新定义GD**T。

### 1.2 全局描述符寄存器（GDTR）

![image-20230410230442842](C:\Users\威威\AppData\Roaming\Typora\typora-user-images\image-20230410230442842.png)

​																										图1 全局描述符寄存器

​		如图1，该寄存器是处理器内部有一个48位的寄存器。共分为两部分，分别是32位的线性地址和16位的边界。32位的处理器具有32根地址线，可以访问的地址范围是0x00000000到0xFFFFFFFF，即4GB内存。所以，**GDTR的32位线性基地址部分保存的是GDT存放在内存中的起始线性地址，16位边界部分保存的是全局描述符表的边界**（界限），其在数值上等于表的大小（总字节数）减一。

​		16位边界如何理解：代表的是GDT表在内存中的偏移线性地址，最大为2^16字节，也就是说该表最大占64KB内存。又因为一个描述符占8字节，故最多可以定义66536/8=8192个描述符。

​		**cpu如何查GDT表：<font color="red">通过读取GDTR寄存器，得到GDT表其实线性地址+低16位中的偏移，来得出某一个段描述符的内存地址。从而读取这个段描述符信息。</font>**

​									![image-20230410232022233](C:\Users\威威\AppData\Roaming\Typora\typora-user-images\image-20230410232022233.png)		

​																										图2 GDTR与GDT的关系
























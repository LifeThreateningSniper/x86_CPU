## 1 Inter处理器的发展

16位的8086处理器->16位的80286处理器->32位的80386处理器->80486处理器

## 2 实模式和保护模式的由来

​		在还是16位CPU的天下时，并没有实模式这一说。直到CPU发展到32位，推出保护模式后，为了区别两种模式，便将之前的模式称为实模式。处于向下兼容的考虑，现代的CPU依然保持对16位模式的兼容，刚开机时，32位的CPU是先处于16位的实模式的，而后再进入保护模式。

##  3 实模式和保护模式的区别

### 3.1 实模式

#### 3.1.1 实模式的特点

1）地址总线只使用了20根，其寻址范围是2^20byte=1MB。

2）寄存器只使用了16bits。所以是16bits的寄存器寻址的话，最大也就64KB。显然无法满足用户需求，采用下述策略，将寻址范围提高到了1MB。

3）分段内存访问方式：**采用“段+偏移”的方式，即“段基址：段内偏移地址”，而真实的物理地址为段基址\*16（左移4位） + 段内偏移地址**。<font color=red>如此便用16位的寄存器访问到了20位的空间(乘以16相当于左移4位)。</font>

4）在可寻址范围内，程序可任意访问任何物理地址，不安全，也不灵活。程序可随意修改自己的段基址，任意访问改变所有内存。

5）<font color=red>**一次只能运行一个程序，浪费计算机资源。**</font>

### 3.2 保护模式

#### 3.2.1 为什么需要保护模式？

因为实模式太不安全，所以引入了保护模式，保护模式通过段式管理和页式管理根据段的特权级来进行保护和隔离，其中段式管理是必不可少的，页式管理是可选的。

#### 3.2.2 保护模式特点

1）地址总线使用32位，**寻址范围2^32B = 4G**。
2）通用寄存器、标志寄存器、指令指针寄存器扩展到了32位，<font color=red>**段寄存器没变。**</font>
3）仍然采用**段基址：段内偏移地址**的访问策略，但**引入了全局描述符表**，由此间接安全的访问内存。

## 3 实模式到保护模式的过渡

**第一步：打开A20地址线**
		地址线编号从0开始，实模式下只用了其中20根即A0~A19，这是因为A20Gate的存在，它可以控制A20地址线的有效性，而实模式下是将A20关闭了的。因此只要打开A20便可突破1M的局限性，访问更大的内存空间。
A20Gate由键盘控制器(i8042芯片)控制，虽然由键盘控制器控制，但实际上与键盘并没有什么关系，这是IBM利用键盘控制器上剩余的输出线来对A20管理控制，物尽其用。

**第二步：加载GDT**
		先在MBR引导程序中创建GDT，再使用lgdt m16&32(m为48位内存数据)指令将m加载到GDTR寄存器，使得CPU知道全局描述符表在哪。

​		GDTR寄存器是48bits的，其中32bits的是GDT表存放的基地址，使得CPU知道全局描述符表在哪。另外16bits的GDT表中表项（段描述符）可以存放的界限，一个表项占8字节，那么2^16 / 8 = 8192，同样可以说明最多有8192个描述符。

**第三步：将CR0寄存器PE位置1**
CR0寄存器是控制寄存器，大致结构如下：

​								![image-20230415221859651](C:\Users\威威\AppData\Roaming\Typora\typora-user-images\image-20230415221859651.png)			

​																												图1. CR0寄存器

